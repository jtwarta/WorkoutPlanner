<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0a0a0a">
<title>Workout Advisor</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Figtree:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0a0a0a;
  --surface: #131315;
  --surface2: #1a1a1e;
  --surface3: #222226;
  --border: #2a2a2e;
  --text: #ececee;
  --text-mid: #a0a0a8;
  --text-dim: #66666e;
  --accent: #4ade80;
  --accent-dim: rgba(74, 222, 128, 0.12);
  --warn: #fb923c;
  --warn-dim: rgba(251, 146, 60, 0.12);
  --danger: #f87171;
  --danger-dim: rgba(248, 113, 113, 0.12);
  --blue: #60a5fa;
  --purple: #c084fc;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: 'Figtree', -apple-system, sans-serif;
  background: var(--bg); color: var(--text);
  min-height: 100vh; -webkit-font-smoothing: antialiased; line-height: 1.5;
}
.app { max-width: 480px; margin: 0 auto; padding: 20px 18px 120px; }
.header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 8px 0 16px; margin-bottom: 20px; border-bottom: 1px solid var(--border);
}
.header h1 { font-size: 20px; font-weight: 700; letter-spacing: -0.5px; }
.header .subtitle { font-size: 11px; color: var(--text-dim); font-family: 'JetBrains Mono', monospace; margin-top: 2px; }
.btn-refresh {
  padding: 7px 14px; font-size: 12px; font-weight: 500;
  background: var(--surface2); color: var(--text-mid);
  border: 1px solid var(--border); border-radius: 8px;
  cursor: pointer; font-family: 'Figtree', sans-serif;
  -webkit-tap-highlight-color: transparent;
}
.btn-refresh:active { background: var(--surface3); transform: scale(0.97); }
.card {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 14px; padding: 18px; margin-bottom: 14px;
}
.card-title {
  font-size: 11px; font-weight: 600; text-transform: uppercase;
  letter-spacing: 1.5px; color: var(--text-dim); margin-bottom: 14px;
}
.tabs {
  display: flex; gap: 4px; margin-bottom: 18px;
  background: var(--surface); border-radius: 12px; padding: 4px;
  border: 1px solid var(--border);
}
.tab {
  flex: 1; padding: 9px 6px; text-align: center; font-size: 13px;
  font-weight: 600; border-radius: 9px; cursor: pointer;
  color: var(--text-dim); transition: all 0.25s ease;
  border: none; background: none; font-family: 'Figtree', sans-serif;
  -webkit-tap-highlight-color: transparent;
}
.tab.active { background: var(--surface3); color: var(--text); }
.session-summary { font-size: 13px; color: var(--text-mid); margin-bottom: 16px; line-height: 1.5; }
.session-summary strong { color: var(--text); font-weight: 600; }
.session-group { margin-bottom: 20px; }
.session-group:last-child { margin-bottom: 0; }
.session-group-header {
  display: flex; align-items: center; justify-content: space-between;
  margin-bottom: 10px; padding-bottom: 8px; border-bottom: 1px solid var(--border);
  cursor: pointer; -webkit-tap-highlight-color: transparent;
}
.session-group-name { font-size: 14px; font-weight: 700; }
.session-group-badge {
  font-size: 10px; font-weight: 600; padding: 3px 8px; border-radius: 6px;
  font-family: 'JetBrains Mono', monospace; text-transform: uppercase; letter-spacing: 0.5px;
}
.badge-high { background: var(--danger-dim); color: var(--danger); }
.badge-med { background: var(--warn-dim); color: var(--warn); }
.badge-low { background: var(--accent-dim); color: var(--accent); }
.session-group-explain {
  max-height: 0; overflow: hidden; transition: max-height 0.3s ease, opacity 0.25s ease; opacity: 0;
}
.session-group-explain.open { opacity: 1; }
.session-group-explain-text {
  font-size: 13px; color: var(--text-mid); line-height: 1.55;
  padding: 0 0 12px; margin-top: -4px;
}
.session-group-explain-text strong { color: var(--text); font-weight: 600; }
.ex-row {
  display: flex; align-items: baseline; justify-content: space-between;
  padding: 8px 0; border-bottom: 1px solid rgba(42,42,46,0.5);
}
.ex-row:last-child { border-bottom: none; }
.ex-name { font-size: 14px; font-weight: 500; flex: 1; min-width: 0; padding-right: 10px; }
.ex-rx {
  font-family: 'JetBrains Mono', monospace; font-size: 12px;
  color: var(--accent); white-space: nowrap; flex-shrink: 0;
}
.session-total {
  display: flex; justify-content: space-between; align-items: center;
  padding: 12px 0 0; margin-top: 8px; border-top: 1px solid var(--border);
  font-family: 'JetBrains Mono', monospace; font-size: 12px; color: var(--text-dim);
}
.session-total strong { color: var(--text-mid); font-weight: 600; }
.muscle-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
.muscle-cell { background: var(--surface2); border-radius: 10px; padding: 12px; }
.muscle-name { font-size: 13px; font-weight: 600; }
.muscle-stat { font-size: 11px; color: var(--text-dim); font-family: 'JetBrains Mono', monospace; margin-top: 5px; }
.muscle-bar { height: 4px; background: var(--border); border-radius: 3px; margin-top: 8px; overflow: hidden; }
.muscle-bar-fill { height: 100%; border-radius: 3px; transition: width 0.6s ease; }
.weight-chart { width: 100%; height: 130px; position: relative; }
.weight-chart canvas { width: 100%; height: 100%; }
.weight-current { font-family: 'JetBrains Mono', monospace; font-size: 30px; font-weight: 700; letter-spacing: -1px; }
.weight-delta { font-family: 'JetBrains Mono', monospace; font-size: 13px; margin-left: 8px; }
.workout-item { padding: 10px 0; border-bottom: 1px solid var(--border); }
.workout-item:last-child { border-bottom: none; }
.workout-title { font-size: 14px; font-weight: 600; }
.workout-meta { font-size: 12px; color: var(--text-dim); font-family: 'JetBrains Mono', monospace; margin-top: 3px; line-height: 1.4; }
.loading { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 60vh; gap: 18px; }
.spinner { width: 28px; height: 28px; border: 2.5px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.75s linear infinite; }
@keyframes spin { to { transform: rotate(360deg); } }
.loading-text { font-size: 13px; color: var(--text-dim); font-family: 'JetBrains Mono', monospace; }
.error-msg { background: var(--danger-dim); border: 1px solid rgba(248,113,113,0.2); border-radius: 10px; padding: 14px; font-size: 13px; color: var(--danger); margin-bottom: 14px; }
.hidden { display: none; }
</style>
</head>
<body>
<div class="app" id="app">
  <div id="loading-screen" class="loading">
    <div class="spinner"></div>
    <div class="loading-text" id="loading-text">Connecting to Hevy...</div>
  </div>
  <div id="dashboard" class="hidden">
    <div class="header">
      <div>
        <h1>Workout Advisor</h1>
        <div class="subtitle" id="last-updated"></div>
      </div>
      <button class="btn-refresh" onclick="refreshData()">Refresh</button>
    </div>
    <div id="error-area"></div>
    <div class="tabs">
      <button class="tab active" data-tab="today" onclick="switchTab('today')">Today</button>
      <button class="tab" data-tab="muscles" onclick="switchTab('muscles')">Muscles</button>
      <button class="tab" data-tab="history" onclick="switchTab('history')">History</button>
      <button class="tab" data-tab="weight" onclick="switchTab('weight')">Weight</button>
    </div>
    <div id="tab-today">
      <div class="card" id="session-card"></div>
    </div>
    <div id="tab-muscles" class="hidden">
      <div class="card">
        <div class="card-title">Muscle Group Status</div>
        <div id="muscle-grid" class="muscle-grid"></div>
      </div>
    </div>
    <div id="tab-history" class="hidden">
      <div class="card">
        <div class="card-title">Recent Workouts</div>
        <div id="recent-workouts"></div>
      </div>
    </div>
    <div id="tab-weight" class="hidden">
      <div class="card">
        <div class="card-title">Body Weight</div>
        <div style="display:flex;align-items:baseline;margin-bottom:18px;">
          <span class="weight-current" id="weight-current">--</span>
          <span class="weight-delta" id="weight-delta"></span>
          <span style="font-size:13px;color:var(--text-dim);margin-left:6px;">lbs</span>
        </div>
        <div class="weight-chart"><canvas id="weight-canvas"></canvas></div>
      </div>
    </div>
  </div>
</div>
<script>
(function() {
  "use strict";

// Profile (silent - never displayed)
var PROFILE = {
dob: new Date(‘1989-07-21’),
sex: ‘male’,
bodyweightLbs: 166,
sessionMinutes: 55
};

// Session constraints
// ~2.5 min per set avg => 55 min = ~22 sets
// Cap each muscle group at 7 sets per session (research: >8 = diminishing returns)
var MAX_SESSION_SETS = 22;
var MAX_SETS_PER_MUSCLE = 7;
var TARGET_GROUPS = 3;

// Exercise classification
var EXERCISE_MUSCLE_MAP = [
{ p: /bench press/i, m: ‘chest’, s: [‘triceps’,‘shoulders’] },
{ p: /chest press/i, m: ‘chest’, s: [‘triceps’,‘shoulders’] },
{ p: /chest fly/i, m: ‘chest’, s: [] },
{ p: /cable fly/i, m: ‘chest’, s: [] },
{ p: /chest dip/i, m: ‘chest’, s: [‘triceps’,‘shoulders’] },
{ p: /push.?up/i, m: ‘chest’, s: [‘triceps’,‘shoulders’] },
{ p: /pec.?deck/i, m: ‘chest’, s: [] },
{ p: /dip/i, m: ‘chest’, s: [‘triceps’,‘shoulders’] },
{ p: /romanian deadlift/i, m: ‘hamstrings’, s: [‘glutes’,‘back’] },
{ p: /deadlift/i, m: ‘back’, s: [‘hamstrings’,‘glutes’] },
{ p: /pull.?up/i, m: ‘back’, s: [‘biceps’] },
{ p: /chin.?up/i, m: ‘back’, s: [‘biceps’] },
{ p: /lat.?pull/i, m: ‘back’, s: [‘biceps’] },
{ p: /row/i, m: ‘back’, s: [‘biceps’] },
{ p: /rack pull/i, m: ‘back’, s: [‘hamstrings’] },
{ p: /back extension/i, m: ‘back’, s: [‘glutes’] },
{ p: /good morning/i, m: ‘back’, s: [‘hamstrings’,‘glutes’] },
{ p: /shrug/i, m: ‘back’, s: [] },
{ p: /face pull/i, m: ‘back’, s: [‘shoulders’] },
{ p: /overhead press/i, m: ‘shoulders’, s: [‘triceps’] },
{ p: /shoulder press/i, m: ‘shoulders’, s: [‘triceps’] },
{ p: /military press/i, m: ‘shoulders’, s: [‘triceps’] },
{ p: /arnold press/i, m: ‘shoulders’, s: [‘triceps’] },
{ p: /lateral raise/i, m: ‘shoulders’, s: [] },
{ p: /front raise/i, m: ‘shoulders’, s: [] },
{ p: /rear delt/i, m: ‘shoulders’, s: [] },
{ p: /pike push/i, m: ‘shoulders’, s: [‘triceps’] },
{ p: /bicep curl/i, m: ‘biceps’, s: [] },
{ p: /hammer curl/i, m: ‘biceps’, s: [] },
{ p: /concentration curl/i, m: ‘biceps’, s: [] },
{ p: /preacher curl/i, m: ‘biceps’, s: [] },
{ p: /kettlebell curl/i, m: ‘biceps’, s: [] },
{ p: /tricep/i, m: ‘triceps’, s: [] },
{ p: /skull.?crush/i, m: ‘triceps’, s: [] },
{ p: /squat/i, m: ‘quads’, s: [‘glutes’,‘hamstrings’] },
{ p: /leg press/i, m: ‘quads’, s: [‘glutes’] },
{ p: /leg extension/i, m: ‘quads’, s: [] },
{ p: /lunge/i, m: ‘quads’, s: [‘glutes’,‘hamstrings’] },
{ p: /step.?up/i, m: ‘quads’, s: [‘glutes’] },
{ p: /hack squat/i, m: ‘quads’, s: [‘glutes’] },
{ p: /leg curl/i, m: ‘hamstrings’, s: [] },
{ p: /nordic curl/i, m: ‘hamstrings’, s: [] },
{ p: /stiff.?leg/i, m: ‘hamstrings’, s: [‘glutes’,‘back’] },
{ p: /hip thrust/i, m: ‘glutes’, s: [‘hamstrings’] },
{ p: /glute/i, m: ‘glutes’, s: [] },
{ p: /hip abduction/i, m: ‘glutes’, s: [] },
{ p: /hip adduction/i, m: ‘glutes’, s: [] },
{ p: /calf/i, m: ‘calves’, s: [] },
{ p: /crunch/i, m: ‘core’, s: [] },
{ p: /sit.?up/i, m: ‘core’, s: [] },
{ p: /plank/i, m: ‘core’, s: [] },
{ p: /leg raise/i, m: ‘core’, s: [] },
{ p: /knee raise/i, m: ‘core’, s: [] },
{ p: /hanging/i, m: ‘core’, s: [] },
{ p: /russian twist/i, m: ‘core’, s: [] },
{ p: /ab roll/i, m: ‘core’, s: [] },
{ p: /wood.?chop/i, m: ‘core’, s: [] }
];

var CARDIO = [/treadmill/i, /elliptical/i, /bike/i, /cycling/i, /rowing machine/i, /jump rope/i, /jumping jack/i, /burpee/i, /stair/i, /running/i, /walking/i];

function classify(name) {
var i;
for (i = 0; i < CARDIO.length; i++) { if (CARDIO[i].test(name)) return { m: ‘cardio’, s: [] }; }
for (i = 0; i < EXERCISE_MUSCLE_MAP.length; i++) {
var e = EXERCISE_MUSCLE_MAP[i];
if (e.p.test(name)) return { m: e.m, s: e.s };
}
return { m: ‘other’, s: [] };
}

var MG = {
chest:      { name: ‘Chest’,      freq: 4, color: ‘#f87171’, ideal: 14 },
back:       { name: ‘Back’,       freq: 4, color: ‘#60a5fa’, ideal: 16 },
shoulders:  { name: ‘Shoulders’,  freq: 4, color: ‘#c084fc’, ideal: 14 },
biceps:     { name: ‘Biceps’,     freq: 5, color: ‘#34d399’, ideal: 10 },
triceps:    { name: ‘Triceps’,    freq: 5, color: ‘#fbbf24’, ideal: 10 },
quads:      { name: ‘Quads’,      freq: 4, color: ‘#fb923c’, ideal: 14 },
hamstrings: { name: ‘Hamstrings’, freq: 5, color: ‘#f472b6’, ideal: 12 },
glutes:     { name: ‘Glutes’,     freq: 5, color: ‘#a78bfa’, ideal: 12 },
calves:     { name: ‘Calves’,     freq: 5, color: ‘#2dd4bf’, ideal: 10 },
core:       { name: ‘Core’,       freq: 3, color: ‘#e879f9’, ideal: 10 }
};

// Exercise DB: benchmarks for ~166lb intermediate male
var EDB = {
‘Bench Press (Barbell)’:            { mu: ‘chest’, bm: 185, st: 4, rp: ‘6-8’ },
‘Incline Bench Press (Dumbbell)’:   { mu: ‘chest’, bm: 60, st: 3, rp: ‘8-10’, nt: ‘ea’ },
‘Incline Bench Press (Barbell)’:    { mu: ‘chest’, bm: 155, st: 4, rp: ‘6-8’ },
‘Chest Fly (Machine)’:             { mu: ‘chest’, bm: 140, st: 3, rp: ‘10-12’ },
‘Chest Fly (Dumbbell)’:            { mu: ‘chest’, bm: 40, st: 3, rp: ‘10-12’, nt: ‘ea’ },
‘Cable Fly Crossovers’:            { mu: ‘chest’, bm: 30, st: 3, rp: ‘12-15’, nt: ‘ea’ },
‘Chest Press (Machine)’:           { mu: ‘chest’, bm: 160, st: 3, rp: ‘8-10’ },
‘Bent Over Row (Barbell)’:         { mu: ‘back’, bm: 165, st: 4, rp: ‘6-8’ },
‘Pull Up’:                         { mu: ‘back’, bm: 0, st: 4, rp: ‘6-10’, nt: ‘bw’ },
‘Chin Up’:                         { mu: ‘back’, bm: 0, st: 3, rp: ‘6-10’, nt: ‘bw’ },
‘Lat Pulldown (Cable)’:            { mu: ‘back’, bm: 140, st: 3, rp: ‘8-10’ },
‘Lat Pulldown (Machine)’:          { mu: ‘back’, bm: 140, st: 3, rp: ‘8-10’ },
‘Seated Row (Machine)’:            { mu: ‘back’, bm: 140, st: 3, rp: ‘8-10’ },
‘Dumbbell Row’:                    { mu: ‘back’, bm: 65, st: 3, rp: ‘8-10’, nt: ‘ea’ },
‘Deadlift (Barbell)’:              { mu: ‘back’, bm: 275, st: 3, rp: ‘5-6’ },
‘Overhead Press (Barbell)’:        { mu: ‘shoulders’, bm: 115, st: 4, rp: ‘6-8’ },
‘Overhead Press (Dumbbell)’:       { mu: ‘shoulders’, bm: 45, st: 3, rp: ‘8-10’, nt: ‘ea’ },
‘Lateral Raise (Dumbbell)’:        { mu: ‘shoulders’, bm: 20, st: 4, rp: ‘12-15’, nt: ‘ea’ },
‘Lateral Raise (Machine)’:         { mu: ‘shoulders’, bm: 80, st: 3, rp: ‘12-15’ },
‘Arnold Press (Dumbbell)’:         { mu: ‘shoulders’, bm: 40, st: 3, rp: ‘8-10’, nt: ‘ea’ },
‘Seated Shoulder Press (Machine)’: { mu: ‘shoulders’, bm: 120, st: 3, rp: ‘8-10’ },
‘Shoulder Press (Dumbbell)’:       { mu: ‘shoulders’, bm: 45, st: 3, rp: ‘8-10’, nt: ‘ea’ },
‘Bicep Curl (Barbell)’:            { mu: ‘biceps’, bm: 75, st: 3, rp: ‘8-10’ },
‘Bicep Curl (Dumbbell)’:           { mu: ‘biceps’, bm: 30, st: 3, rp: ‘10-12’, nt: ‘ea’ },
‘Hammer Curl (Dumbbell)’:          { mu: ‘biceps’, bm: 35, st: 3, rp: ‘10-12’, nt: ‘ea’ },
‘Hammer Curl (Cable)’:             { mu: ‘biceps’, bm: 35, st: 3, rp: ‘10-12’, nt: ‘ea’ },
‘Concentration Curl’:              { mu: ‘biceps’, bm: 25, st: 3, rp: ‘10-12’, nt: ‘ea’ },
‘Triceps Pushdown’:                { mu: ‘triceps’, bm: 60, st: 3, rp: ‘10-12’ },
‘Triceps Rope Pushdown’:           { mu: ‘triceps’, bm: 55, st: 3, rp: ‘10-12’ },
‘Triceps Extension (Cable)’:       { mu: ‘triceps’, bm: 50, st: 3, rp: ‘10-12’ },
‘Triceps Extension (Dumbbell)’:    { mu: ‘triceps’, bm: 30, st: 3, rp: ‘10-12’ },
‘Skullcrusher (Dumbbell)’:         { mu: ‘triceps’, bm: 25, st: 3, rp: ‘10-12’, nt: ‘ea’ },
‘Squat (Barbell)’:                 { mu: ‘quads’, bm: 225, st: 4, rp: ‘5-8’ },
‘Leg Press (Machine)’:             { mu: ‘quads’, bm: 360, st: 4, rp: ‘8-10’ },
‘Front Squat’:                     { mu: ‘quads’, bm: 175, st: 3, rp: ‘6-8’ },
‘Goblet Squat’:                    { mu: ‘quads’, bm: 60, st: 3, rp: ‘10-12’ },
‘Lunge (Dumbbell)’:                { mu: ‘quads’, bm: 40, st: 3, rp: ‘10-12’, nt: ‘ea’ },
‘Romanian Deadlift (Barbell)’:     { mu: ‘hamstrings’, bm: 205, st: 4, rp: ‘8-10’ },
‘Romanian Deadlift (Dumbbell)’:    { mu: ‘hamstrings’, bm: 55, st: 3, rp: ‘8-10’, nt: ‘ea’ },
‘Seated Leg Curl (Machine)’:       { mu: ‘hamstrings’, bm: 110, st: 3, rp: ‘10-12’ },
‘Hip Thrust (Barbell)’:            { mu: ‘glutes’, bm: 225, st: 4, rp: ‘8-10’ },
‘Hip Thrust (Machine)’:            { mu: ‘glutes’, bm: 225, st: 3, rp: ‘8-10’ },
‘Glute Kickback (Machine)’:        { mu: ‘glutes’, bm: 80, st: 3, rp: ‘12-15’ },
‘Hip Abduction (Machine)’:         { mu: ‘glutes’, bm: 120, st: 3, rp: ‘12-15’ },
‘Standing Calf Raise’:             { mu: ‘calves’, bm: 180, st: 4, rp: ‘12-15’ },
‘Seated Calf Raise’:               { mu: ‘calves’, bm: 90, st: 3, rp: ‘12-15’ },
‘Calf Extension (Machine)’:        { mu: ‘calves’, bm: 140, st: 3, rp: ‘12-15’ },
‘Hanging Leg Raise’:               { mu: ‘core’, bm: 0, st: 3, rp: ‘10-15’, nt: ‘bw’ },
‘Crunch (Machine)’:                { mu: ‘core’, bm: 80, st: 3, rp: ‘12-15’ },
‘Plank’:                           { mu: ‘core’, bm: 0, st: 3, rp: ‘45-60s’, nt: ‘hold’ },
‘Decline Crunch’:                  { mu: ‘core’, bm: 0, st: 3, rp: ‘12-15’, nt: ‘bw’ }
};

var PICKS = {
chest:      [‘Bench Press (Barbell)’, ‘Incline Bench Press (Dumbbell)’, ‘Chest Fly (Machine)’, ‘Cable Fly Crossovers’],
back:       [‘Bent Over Row (Barbell)’, ‘Pull Up’, ‘Lat Pulldown (Cable)’, ‘Seated Row (Machine)’],
shoulders:  [‘Overhead Press (Barbell)’, ‘Lateral Raise (Dumbbell)’, ‘Arnold Press (Dumbbell)’, ‘Lateral Raise (Machine)’],
biceps:     [‘Bicep Curl (Barbell)’, ‘Hammer Curl (Dumbbell)’, ‘Concentration Curl’],
triceps:    [‘Triceps Pushdown’, ‘Triceps Extension (Cable)’, ‘Skullcrusher (Dumbbell)’],
quads:      [‘Squat (Barbell)’, ‘Leg Press (Machine)’, ‘Front Squat’, ‘Lunge (Dumbbell)’],
hamstrings: [‘Romanian Deadlift (Barbell)’, ‘Seated Leg Curl (Machine)’],
glutes:     [‘Hip Thrust (Barbell)’, ‘Glute Kickback (Machine)’, ‘Hip Abduction (Machine)’],
calves:     [‘Standing Calf Raise’, ‘Seated Calf Raise’],
core:       [‘Hanging Leg Raise’, ‘Crunch (Machine)’, ‘Plank’]
};

var WEIGHT_DATA = [
{ date: ‘2026-01-18’, value: 166.0 }, { date: ‘2026-01-17’, value: 164.4 },
{ date: ‘2025-11-30’, value: 168.0 }, { date: ‘2025-11-04’, value: 167.1 },
{ date: ‘2025-11-01’, value: 168.2 }, { date: ‘2025-10-01’, value: 169.0 },
{ date: ‘2025-09-12’, value: 169.0 }, { date: ‘2025-09-07’, value: 168.0 },
{ date: ‘2025-07-15’, value: 172.0 }, { date: ‘2025-05-23’, value: 174.2 },
{ date: ‘2025-05-15’, value: 172.0 }, { date: ‘2025-04-30’, value: 173.0 }
];

var API_KEY = ‘e38cf123-61c4-4b8c-ae25-7442d6d9c874’;
var API_BASE = ‘https://api.hevyapp.com/v1’;
var workoutCache = null;
var exerciseHistory = {};

// –– API ––
function fetchWorkouts() {
var all = [];
var page = 1;
var totalPages = 1;

```
function fetchPage() {
  updateLoading('Loading workouts (' + all.length + ')...');
  return fetch(API_BASE + '/workouts?page=' + page + '&pageSize=10', {
    headers: { 'api-key': API_KEY }
  })
  .then(function(r) {
    if (!r.ok) throw new Error('API error ' + r.status);
    return r.json();
  })
  .then(function(d) {
    totalPages = d.page_count || 1;
    if (d.workouts) {
      for (var i = 0; i < d.workouts.length; i++) all.push(d.workouts[i]);
    }
    page++;
    if (page <= totalPages && page <= 10) return fetchPage();
    return all;
  });
}

return fetchPage();
```

}

// –– Exercise History ––
function buildExerciseHistory(workouts) {
var hist = {};
var sorted = workouts.slice().sort(function(a, b) {
return new Date(a.start_time || a.created_at) - new Date(b.start_time || b.created_at);
});
for (var wi = 0; wi < sorted.length; wi++) {
var w = sorted[wi];
var wDate = new Date(w.start_time || w.created_at);
var exs = w.exercises || [];
for (var ei = 0; ei < exs.length; ei++) {
var ex = exs[ei];
var name = ex.title || ‘’;
if (!name) continue;
var sets = (ex.sets || []).filter(function(s) { return s.set_type === ‘normal’ || !s.set_type; });
if (sets.length === 0) continue;
var best = 0, bestR = 0;
for (var si = 0; si < sets.length; si++) {
var lbs = Math.round((sets[si].weight_kg || 0) * 2.20462);
if (lbs > best) { best = lbs; bestR = sets[si].reps || 0; }
}
if (!hist[name]) hist[name] = { weights: [], dates: [] };
hist[name].lastWeightLbs = best;
hist[name].lastReps = bestR;
hist[name].lastDate = wDate;
hist[name].lastSets = sets.length;
hist[name].weights.push(best);
hist[name].dates.push(wDate);
}
}
return hist;
}

// –– Prescribe ––
function prescribe(name) {
var db = EDB[name];
var hist = exerciseHistory[name];
var sets = db ? db.st : 3;
var reps = db ? db.rp : ‘8-10’;
var wt = db ? db.bm : 0;
var note = db ? (db.nt || ‘’) : ‘’;

```
if (hist && hist.lastWeightLbs > 0) {
  var last = hist.lastWeightLbs;
  var ws = hist.weights;
  var trend = ws.length >= 3 ? (ws[ws.length-1] + ws[ws.length-2] + ws[ws.length-3]) / 3 : last;
  if (db && last < db.bm * 0.85) {
    wt = Math.min(Math.round(trend * 1.05 / 5) * 5, db.bm);
  } else {
    wt = Math.round(trend * 1.025 / 5) * 5;
  }
  if (hist.lastSets >= 2 && hist.lastSets <= 6) sets = hist.lastSets;
}
if (note === 'bw' || note === 'hold') wt = 0;
return { sets: sets, reps: reps, wt: wt, note: note };
```

}

function fmtRx(p) {
var s = p.sets + String.fromCharCode(215) + p.reps;
if (p.wt > 0) s += ’ @ ’ + p.wt;
if (p.note === ‘ea’) s += ‘/ea’;
return s;
}

// –– Analyze ––
function analyze(workouts) {
var now = new Date();
var stats = {};
var key;
for (key in MG) {
stats[key] = {
key: key, name: MG[key].name, color: MG[key].color,
freq: MG[key].freq, ideal: MG[key].ideal,
lastTrained: null, daysSince: Infinity,
sets30d: 0, sessions30d: 0
};
}
var cutoff = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
for (var wi = 0; wi < workouts.length; wi++) {
var w = workouts[wi];
var wDate = new Date(w.start_time || w.created_at);
var isRecent = wDate >= cutoff;
var hit = {};
var exs = w.exercises || [];
for (var ei = 0; ei < exs.length; ei++) {
var cl = classify(exs[ei].title || ‘’);
if (cl.m === ‘cardio’ || cl.m === ‘other’) continue;
var muscles = [cl.m].concat(cl.s);
for (var mi = 0; mi < muscles.length; mi++) {
var mu = muscles[mi];
if (!stats[mu]) continue;
var st = stats[mu];
if (!st.lastTrained || wDate > st.lastTrained) {
st.lastTrained = wDate;
st.daysSince = Math.floor((now - wDate) / (1000 * 60 * 60 * 24));
}
if (isRecent) {
var sc = (exs[ei].sets || []).length;
var weight = mu === cl.m ? 1.0 : 0.5;
st.sets30d += Math.round(sc * weight);
hit[mu] = true;
}
}
}
if (isRecent) {
for (var h in hit) { if (stats[h]) stats[h].sessions30d++; }
}
}
return stats;
}

// –– Session Plan ––
function buildSession(stats) {
var scores = [];
var wkVol = {}, ratios = {}, maxR = 0;
var key;
for (key in stats) {
wkVol[key] = stats[key].sets30d / 4.3;
ratios[key] = wkVol[key] / stats[key].ideal;
if (ratios[key] > maxR) maxR = ratios[key];
}
for (key in stats) {
var st = stats[key];
var recency = Math.min(st.daysSince / st.freq, 3);
var volDef = Math.max(0, 1 - (st.sets30d / (st.ideal * 4.3)));
var imbal = maxR > 0 ? Math.max(0, 1 - (ratios[key] / maxR)) : 0;
var score = (recency * 0.4) + (volDef * 0.3) + (imbal * 0.3);
var urgency = ‘low’;
if (st.daysSince >= st.freq * 2 || (volDef > 0.6 && imbal > 0.5)) urgency = ‘high’;
else if (st.daysSince >= st.freq || volDef > 0.3) urgency = ‘med’;

```
  var wkAct = wkVol[key].toFixed(1);
  var parts = [];
  if (st.daysSince === Infinity) {
    parts.push('No recent training data found');
  } else {
    if (st.daysSince >= st.freq * 2)
      parts.push('Last trained <strong>' + st.daysSince + ' days ago</strong> (due every ' + st.freq + 'd)');
    else if (st.daysSince >= st.freq)
      parts.push(st.daysSince + 'd since last session (ideal: every ' + st.freq + 'd)');
    if (volDef > 0.3)
      parts.push('<strong>' + wkAct + '</strong> sets/wk vs ' + st.ideal + ' target (' + Math.round(volDef * 100) + '% below)');
    if (imbal > 0.4) {
      var topK = Object.keys(ratios).sort(function(a,b){return ratios[b]-ratios[a];})[0];
      if (topK !== key) parts.push('Lagging vs ' + stats[topK].name.toLowerCase());
    }
  }
  if (parts.length === 0) parts.push('On track: ' + wkAct + ' sets/wk near the ' + st.ideal + ' target');

  scores.push({
    key: key, name: st.name, color: st.color,
    score: score, urgency: urgency,
    explain: parts.join('. ') + '.',
    daysSince: st.daysSince
  });
}
scores.sort(function(a, b) { return b.score - a.score; });

var groups = [];
var totalSets = 0;
for (var i = 0; i < scores.length && groups.length < TARGET_GROUPS; i++) {
  var rec = scores[i];
  var picks = PICKS[rec.key] || [];
  if (picks.length === 0) continue;
  var gExs = [];
  var gSets = 0;
  for (var j = 0; j < picks.length && gSets < MAX_SETS_PER_MUSCLE; j++) {
    var rx = prescribe(picks[j]);
    var toAdd = Math.min(rx.sets, MAX_SETS_PER_MUSCLE - gSets, MAX_SESSION_SETS - totalSets - gSets);
    if (toAdd <= 0) break;
    rx.sets = toAdd;
    gExs.push({ name: picks[j], rx: rx });
    gSets += toAdd;
  }
  if (gSets > 0 && totalSets + gSets <= MAX_SESSION_SETS) {
    groups.push({
      key: rec.key, name: rec.name, color: rec.color,
      urgency: rec.urgency, explain: rec.explain,
      exercises: gExs, totalSets: gSets
    });
    totalSets += gSets;
  }
}
return { groups: groups, totalSets: totalSets, allScores: scores };
```

}

// –– Render Session ––
function renderSession(plan) {
var card = document.getElementById(‘session-card’);
var estMin = Math.round(plan.totalSets * 2.5);
var dot = String.fromCharCode(183);
var names = [];
for (var gi = 0; gi < plan.groups.length; gi++) names.push(plan.groups[gi].name);

```
var html = '<div class="card-title">Today' + String.fromCharCode(8217) + 's Session</div>';
html += '<div class="session-summary">';
html += '<strong>' + names.join(' + ') + '</strong>';
html += ' ' + dot + ' ' + plan.totalSets + ' sets ' + dot + ' ~' + estMin + ' min';
html += '</div>';

for (var gi = 0; gi < plan.groups.length; gi++) {
  var g = plan.groups[gi];
  html += '<div class="session-group">';
  html += '<div class="session-group-header" onclick="window._toggleExplain(this)">';
  html += '<div class="session-group-name" style="color:' + g.color + '">' + g.name;
  html += ' <span style="font-weight:400;font-size:12px;color:var(--text-dim)">' + g.totalSets + ' sets</span></div>';
  html += '<div class="session-group-badge badge-' + g.urgency + '">' + g.urgency + '</div>';
  html += '</div>';
  html += '<div class="session-group-explain"><div class="session-group-explain-text">' + g.explain + '</div></div>';
  for (var ei = 0; ei < g.exercises.length; ei++) {
    var ex = g.exercises[ei];
    html += '<div class="ex-row">';
    html += '<div class="ex-name">' + ex.name + '</div>';
    html += '<div class="ex-rx">' + fmtRx(ex.rx) + '</div>';
    html += '</div>';
  }
  html += '</div>';
}
html += '<div class="session-total"><span>Total</span><strong>' + plan.totalSets + ' sets ' + dot + ' ~' + estMin + ' min</strong></div>';
card.innerHTML = html;
```

}

window._toggleExplain = function(el) {
var expand = el.nextElementSibling;
if (expand.classList.contains(‘open’)) {
expand.style.maxHeight = ‘0’;
expand.classList.remove(‘open’);
} else {
var allOpen = document.querySelectorAll(’.session-group-explain.open’);
for (var i = 0; i < allOpen.length; i++) {
allOpen[i].style.maxHeight = ‘0’;
allOpen[i].classList.remove(‘open’);
}
expand.classList.add(‘open’);
expand.style.maxHeight = expand.scrollHeight + ‘px’;
}
};

// –– Render Muscle Grid ––
function renderMuscleGrid(stats) {
var grid = document.getElementById(‘muscle-grid’);
var entries = [];
for (var k in stats) entries.push([k, stats[k]]);
entries.sort(function(a, b) { return b[1].daysSince - a[1].daysSince; });
var maxSets = 1;
for (var i = 0; i < entries.length; i++) {
if (entries[i][1].sets30d > maxSets) maxSets = entries[i][1].sets30d;
}
var dot = String.fromCharCode(183);
var html = ‘’;
for (var i = 0; i < entries.length; i++) {
var st = entries[i][1];
var pct = Math.round((st.sets30d / maxSets) * 100);
var days = st.daysSince === Infinity ? ‘no data’ : st.daysSince + ‘d ago’;
var wk = (st.sets30d / 4.3).toFixed(1);
html += ‘<div class="muscle-cell"><div class="muscle-name" style="color:' + st.color + '">’ + st.name +
‘</div><div class="muscle-stat">’ + days + ’ ’ + dot + ’ ’ + wk + ’ sets/wk</div>’ +
‘<div class="muscle-bar"><div class="muscle-bar-fill" style="width:' + pct + '%;background:' + st.color + '"></div></div></div>’;
}
grid.innerHTML = html;
}

// –– Render History ––
function renderHistory(workouts) {
var c = document.getElementById(‘recent-workouts’);
var n = Math.min(workouts.length, 12);
var dot = String.fromCharCode(183);
var html = ‘’;
for (var i = 0; i < n; i++) {
var w = workouts[i];
var d = new Date(w.start_time || w.created_at);
var ds = d.toLocaleDateString(‘en-US’, { weekday: ‘short’, month: ‘short’, day: ‘numeric’ });
var exs = w.exercises || [];
var names = [];
var ts = 0;
for (var j = 0; j < exs.length; j++) {
names.push(exs[j].title || ‘?’);
ts += (exs[j].sets || []).length;
}
var sum = names.slice(0, 3).join(’, ‘);
if (names.length > 3) sum += ’ +’ + (names.length - 3) + ’ more’;
html += ‘<div class="workout-item"><div class="workout-title">’ + (w.title || ‘Workout’) +
‘</div><div class="workout-meta">’ + ds + ’ ’ + dot + ’ ’ + ts + ’ sets ’ + dot + ’ ’ + sum + ‘</div></div>’;
}
c.innerHTML = html;
}

// –– Render Weight ––
function renderWeight() {
var cut = new Date();
cut.setFullYear(cut.getFullYear() - 1);
var recent = [];
for (var i = WEIGHT_DATA.length - 1; i >= 0; i–) {
if (new Date(WEIGHT_DATA[i].date) >= cut) recent.push(WEIGHT_DATA[i]);
}
recent.reverse();
if (recent.length === 0) return;
var cur = WEIGHT_DATA[0].value;
var prev = WEIGHT_DATA.length > 1 ? WEIGHT_DATA[1].value : cur;
var delta = cur - prev;
document.getElementById(‘weight-current’).textContent = cur.toFixed(1);
var de = document.getElementById(‘weight-delta’);
de.textContent = (delta >= 0 ? ‘+’ : ‘’) + delta.toFixed(1);
de.style.color = delta <= 0 ? ‘var(–accent)’ : ‘var(–warn)’;
var canvas = document.getElementById(‘weight-canvas’);
var ctx = canvas.getContext(‘2d’);
var dpr = window.devicePixelRatio || 1;
var rect = canvas.parentElement.getBoundingClientRect();
canvas.width = rect.width * dpr;
canvas.height = 130 * dpr;
canvas.style.width = rect.width + ‘px’;
canvas.style.height = ‘130px’;
ctx.scale(dpr, dpr);
var w = rect.width, h = 130;
var pad = { top: 12, bottom: 22, left: 0, right: 0 };
var vals = [];
for (var i = 0; i < recent.length; i++) vals.push(recent[i].value);
var mn = Math.min.apply(null, vals) - 2;
var mx = Math.max.apply(null, vals) + 2;
var xs = (w - pad.left - pad.right) / Math.max(recent.length - 1, 1);
ctx.beginPath();
ctx.strokeStyle = ‘#4ade80’;
ctx.lineWidth = 2.5;
ctx.lineJoin = ‘round’;
ctx.lineCap = ‘round’;
for (var i = 0; i < recent.length; i++) {
var x = pad.left + i * xs;
var y = pad.top + (1 - (recent[i].value - mn) / (mx - mn)) * (h - pad.top - pad.bottom);
if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
}
ctx.stroke();
var lx = pad.left + (recent.length - 1) * xs;
ctx.lineTo(lx, h - pad.bottom);
ctx.lineTo(pad.left, h - pad.bottom);
ctx.closePath();
var gr = ctx.createLinearGradient(0, 0, 0, h);
gr.addColorStop(0, ‘rgba(74,222,128,0.12)’);
gr.addColorStop(1, ‘rgba(74,222,128,0)’);
ctx.fillStyle = gr;
ctx.fill();
var ends = [0, recent.length - 1];
for (var ei = 0; ei < ends.length; ei++) {
var idx = ends[ei];
var x = pad.left + idx * xs;
var y = pad.top + (1 - (recent[idx].value - mn) / (mx - mn)) * (h - pad.top - pad.bottom);
ctx.beginPath();
ctx.arc(x, y, 4, 0, Math.PI * 2);
ctx.fillStyle = ‘#4ade80’;
ctx.fill();
}
ctx.fillStyle = ‘#66666e’;
ctx.font = ‘11px JetBrains Mono, monospace’;
ctx.textAlign = ‘left’;
ctx.fillText(recent[0].date.substring(5), pad.left, h - 4);
ctx.textAlign = ‘right’;
ctx.fillText(recent[recent.length - 1].date.substring(5), w - pad.right, h - 4);
}

// –– Tabs ––
window.switchTab = function(tab) {
var tabs = document.querySelectorAll(’[id^=“tab-”]’);
for (var i = 0; i < tabs.length; i++) tabs[i].classList.add(‘hidden’);
document.getElementById(‘tab-’ + tab).classList.remove(‘hidden’);
var btns = document.querySelectorAll(’.tab’);
for (var i = 0; i < btns.length; i++) {
btns[i].classList.toggle(‘active’, btns[i].getAttribute(‘data-tab’) === tab);
}
if (tab === ‘weight’) setTimeout(renderWeight, 50);
};

function showScreen(s) {
var screens = [‘loading-screen’, ‘dashboard’];
for (var i = 0; i < screens.length; i++) {
document.getElementById(screens[i]).classList.toggle(‘hidden’, screens[i] !== s);
}
}

function updateLoading(t) {
document.getElementById(‘loading-text’).textContent = t;
}

function showError(m) {
document.getElementById(‘error-area’).innerHTML = ‘<div class="error-msg">’ + m + ‘</div>’;
}

window.refreshData = function() { loadDashboard(); };

function loadDashboard() {
showScreen(‘loading-screen’);
fetchWorkouts()
.then(function(workouts) {
workoutCache = workouts;
updateLoading(‘Analyzing…’);
exerciseHistory = buildExerciseHistory(workouts);
var stats = analyze(workouts);
var plan = buildSession(stats);
showScreen(‘dashboard’);
document.getElementById(‘last-updated’).textContent = ’updated ’ + new Date().toLocaleTimeString(‘en-US’, { hour: ‘numeric’, minute: ‘2-digit’ });
renderSession(plan);
renderMuscleGrid(stats);
renderHistory(workouts);
renderWeight();
})
.catch(function(err) {
console.error(err);
showScreen(‘dashboard’);
showError(’Failed to load: ’ + err.message);
});
}

if (WEIGHT_DATA.length > 0) PROFILE.bodyweightLbs = WEIGHT_DATA[0].value;
loadDashboard();

})();
</script>

</body>
</html>